# ğŸ³ Docker ì™„ë²½ ê°€ì´ë“œ (Basic to Advanced)

ì´ ê°€ì´ë“œëŠ” Dockerì˜ ê¸°ë³¸ ê°œë…ë¶€í„° ì‹¬í™” ê¸°ìˆ ê¹Œì§€, **LogMind AI** í”„ë¡œì íŠ¸ë¥¼ ì˜ˆì‹œë¡œ ë“¤ì–´ ì„¤ëª…í•©ë‹ˆë‹¤.

---

## ğŸ“š 1. Docker ê¸°ì´ˆ (Basics)

### 1.1 Dockerë€?
DockerëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì„ **ì»¨í…Œì´ë„ˆ(Container)**ë¼ëŠ” ê²©ë¦¬ëœ í™˜ê²½ì—ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ë„êµ¬ì…ë‹ˆë‹¤. 
- **ë¬¸ì œ í•´ê²°:** "ë‚´ ì»´í“¨í„°ì—ì„œëŠ” ë˜ëŠ”ë° ì„œë²„ì—ì„œëŠ” ì•ˆ ë¼ìš”"ë¼ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤. (í™˜ê²½ ì¼ì¹˜)
- **ê°€ë²¼ì›€:** ê°€ìƒë¨¸ì‹ (VM)ë³´ë‹¤ í›¨ì”¬ ê°€ë³ê³  ë¹ ë¦…ë‹ˆë‹¤.

### 1.2 í•µì‹¬ ê°œë…
1. **ì´ë¯¸ì§€ (Image):** ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ì— í•„ìš”í•œ ì½”ë“œ, ëŸ°íƒ€ì„, ë¼ì´ë¸ŒëŸ¬ë¦¬ ë“±ì´ í¬í•¨ëœ **ë³€í•˜ì§€ ì•ŠëŠ”(Immutable) í…œí”Œë¦¿**ì…ë‹ˆë‹¤. (ë¹„ìœ : ë¶•ì–´ë¹µ í‹€ ë˜ëŠ” ê²Œì„ ì„¤ì¹˜ CD)
2. **ì»¨í…Œì´ë„ˆ (Container):** ì´ë¯¸ì§€ë¥¼ ì‹¤í–‰í•œ ìƒíƒœì…ë‹ˆë‹¤. í•˜ë‚˜ì˜ ì´ë¯¸ì§€ë¡œ ì—¬ëŸ¬ ê°œì˜ ì»¨í…Œì´ë„ˆë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ë¹„ìœ : ê°“ êµ¬ìš´ ë¶•ì–´ë¹µ ë˜ëŠ” ì‹¤í–‰ ì¤‘ì¸ ê²Œì„)
3. **Dockerfile:** ì´ë¯¸ì§€ë¥¼ ì–´ë–»ê²Œ ë§Œë“¤ì§€ ì •ì˜í•˜ëŠ” ì„¤ê³„ë„ì…ë‹ˆë‹¤.

---

## ğŸ›  2. Dockerfile ì‹¬ì¸µ ë¶„ì„

ì´ í”„ë¡œì íŠ¸ì˜ `frontend/Dockerfile`ì„ ì˜ˆì œë¡œ ì‚´í´ë´…ì‹œë‹¤.

```dockerfile
# 1. Base Image: ë¬´ì—‡ì„ ê¸°ë°˜ìœ¼ë¡œ í•  ê²ƒì¸ê°€? (Node.js 18ë²„ì „ ì‚¬ìš©)
FROM node:18-alpine

# 2. Working Directory: ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ ì‘ì—… í´ë” ì„¤ì •
WORKDIR /app

# 3. Cache Layering: ìì£¼ ë°”ë€Œì§€ ì•ŠëŠ” ì˜ì¡´ì„±(package.json)ì„ ë¨¼ì € ë³µì‚¬
COPY package.json package-lock.json ./
RUN npm ci  # npm installë³´ë‹¤ ë¹ ë¥´ê³  ì •í™•í•œ ì„¤ì¹˜ ëª…ë ¹ì–´

# 4. Source Code: ë‚˜ë¨¸ì§€ ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬
COPY . .

# 5. Port: ì™¸ë¶€ë¡œ ë…¸ì¶œí•  í¬íŠ¸
EXPOSE 3000

# 6. Command: ì»¨í…Œì´ë„ˆ ì‹œì‘ ì‹œ ì‹¤í–‰í•  ëª…ë ¹ì–´
CMD ["npm", "run", "dev"]
```

> **ğŸ’¡ ì‹¬í™” íŒ (Layer Caching):**
> DockerëŠ” ëª…ë ¹ì¤„ í•˜ë‚˜í•˜ë‚˜ë¥¼ 'ë ˆì´ì–´'ë¡œ ì €ì¥í•©ë‹ˆë‹¤. 3ë²ˆ ë‹¨ê³„ì—ì„œ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë³µì‚¬í•˜ê¸° ì „ì— `npm ci`ë¥¼ ë¨¼ì € í•˜ëŠ” ì´ìœ ëŠ”, ì†ŒìŠ¤ ì½”ë“œê°€ ë°”ë€Œì–´ë„ ì˜ì¡´ì„±ì´ ë°”ë€Œì§€ ì•Šì•˜ë‹¤ë©´ `npm ci` ë‹¨ê³„ë¥¼ **ìºì‹œ(Cache)**ì—ì„œ ê°€ì ¸ì™€ ë¹Œë“œ ì†ë„ë¥¼ íšê¸°ì ìœ¼ë¡œ ì¤„ì´ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.

---

## ğŸ™ 3. Docker Compose (Orchestration)

ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆ(DB, í”„ë¡ íŠ¸, ë°±ì—”ë“œ)ë¥¼ í•œ ë²ˆì— ê´€ë¦¬í•˜ê¸° ìœ„í•´ `docker-compose.yml`ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

```yaml
version: '3.8'

services:
  # ë°ì´í„°ë² ì´ìŠ¤ ì„œë¹„ìŠ¤ ì •ì˜
  db:
    image: pgvector/pgvector:pg16  # pgvectorê°€ í¬í•¨ëœ postgres ì´ë¯¸ì§€
    volumes:
      - postgres_data:/var/lib/postgresql/data # ë°ì´í„° ì˜êµ¬ ì €ì¥ (Volume)

  # ë°±ì—”ë“œ ì„œë¹„ìŠ¤
  backend:
    build: 
      context: ./backend # Dockerfile ìœ„ì¹˜
    depends_on:
      - db # DBê°€ ì¼œì§„ í›„ì— ë°±ì—”ë“œ ì‹¤í–‰

  # í”„ë¡ íŠ¸ì—”ë“œ ì„œë¹„ìŠ¤
  frontend:
    depends_on:
      - backend

volumes:
  postgres_data: # ë„ì»¤ê°€ ê´€ë¦¬í•˜ëŠ” ì €ì¥ ê³µê°„ ìƒì„±
```

### ì£¼ìš” ëª…ë ¹ì–´
- `docker-compose up --build`: ì´ë¯¸ì§€ë¥¼ ìƒˆë¡œ ë¹Œë“œí•˜ê³  ì‹¤í–‰
- `docker-compose up -d`: ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰
- `docker-compose down`: ëª¨ë“  ì»¨í…Œì´ë„ˆ ì •ì§€ ë° ë„¤íŠ¸ì›Œí¬ ì‚­ì œ

---

## ğŸš€ 4. ì‹¬í™” ì£¼ì œ (Advanced)

### 4.1 Multi-stage Build (ì´ë¯¸ì§€ ê²½ëŸ‰í™”)
ë°°í¬ìš© ì´ë¯¸ì§€ëŠ” ê°œë°œ ë„êµ¬(git, compiler ë“±)ê°€ í•„ìš” ì—†ìŠµë‹ˆë‹¤. ë¹Œë“œ ë‹¨ê³„ì™€ ì‹¤í–‰ ë‹¨ê³„ë¥¼ ë‚˜ëˆ„ì–´ ìš©ëŸ‰ì„ ì¤„ì…ë‹ˆë‹¤.

```dockerfile
# Builder Stage
FROM node:18-alpine AS builder
WORKDIR /app
COPY . .
RUN npm ci && npm run build

# Runner Stage (ê°€ë²¼ì›€)
FROM node:18-alpine AS runner
WORKDIR /app
# ë¹Œë“œëœ ê²°ê³¼ë¬¼ë§Œ ê°€ì ¸ì˜´
COPY --from=builder /app/.next ./.next
COPY --from=builder /app/public ./public
COPY --from=builder /app/node_modules ./node_modules
CMD ["npm", "start"]
```

### 4.2 Docker Volume (ë°ì´í„° ì˜ì†ì„±)
ì»¨í…Œì´ë„ˆë¥¼ ì‚­ì œí•˜ë©´ ë‚´ë¶€ ë°ì´í„°ë„ ì‚¬ë¼ì§‘ë‹ˆë‹¤. ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ **Volume**ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
- **Bind Mount:** ë‚´ ì»´í“¨í„°ì˜ íŠ¹ì • í´ë”ë¥¼ ì»¨í…Œì´ë„ˆì™€ ê³µìœ  (`- ./src:/app/src`) -> ê°œë°œ ì‹œ ìœ ë¦¬ (ì½”ë“œ ìˆ˜ì • ì¦‰ì‹œ ë°˜ì˜)
- **Docker Volume:** ë„ì»¤ê°€ ê´€ë¦¬í•˜ëŠ” ì•ˆì „í•œ ì €ì¥ì†Œ (`postgres_data:/var/lib/...`) -> DB ë°ì´í„° ì €ì¥ì— ìœ ë¦¬

### 4.3 Docker Network
Docker Composeë¥¼ ì‚¬ìš©í•˜ë©´ `logmind-network` ê°™ì€ ê°€ìƒ ë„¤íŠ¸ì›Œí¬ê°€ ìë™ ìƒì„±ë©ë‹ˆë‹¤.
- ì»¨í…Œì´ë„ˆë¼ë¦¬ëŠ” ì„œë¹„ìŠ¤ ì´ë¦„(`db`, `backend`)ìœ¼ë¡œ í†µì‹ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ì˜ˆ: ë°±ì—”ë“œì—ì„œ DB ì ‘ì† ì‹œ `localhost`ê°€ ì•„ë‹Œ `db` í˜¸ìŠ¤íŠ¸ëª…ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. (`postgresql://user:pass@db:5432/...`)

---

## ğŸ“ 5. í•„ìˆ˜ ëª…ë ¹ì–´ ì¹˜íŠ¸ì‹œíŠ¸

| ëª…ë ¹ì–´ | ì„¤ëª… | ì˜ˆì‹œ |
|---|---|---|
| `docker build` | Dockerfileë¡œ ì´ë¯¸ì§€ ìƒì„± | `docker build -t my-app .` |
| `docker run` | ì´ë¯¸ì§€ë¡œ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ | `docker run -p 3000:3000 my-app` |
| `docker ps` | ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ëª©ë¡ | `docker ps -a` (ì •ì§€ëœ ê²ƒ í¬í•¨) |
| `docker exec` | ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ì ‘ì† | `docker exec -it [ID] /bin/sh` |
| `docker logs` | ë¡œê·¸ í™•ì¸ | `docker logs -f [ID]` |
| `docker system prune` | ì‚¬ìš© ì•ˆ í•˜ëŠ” ë°ì´í„° ì •ë¦¬ | `docker system prune -a` (ì£¼ì˜!) |

